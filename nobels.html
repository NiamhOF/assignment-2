<!DOCTYPE HTML>
<html lang="en">
    
<head>
    <meta charset="utf-8"> 
    <meta name="assignment 2" content="width=device-width, initial-scale=1">
<!--    <link rel="stylesheet" href="../css/styles.css">-->
    <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">
    <title>Assignment 2</title>
    
</head>
<body>  

    <h1>Nobel Prize Winners</h1>
    <p>Between 1901 and 2018, the Nobel prizes have been awarded 590 times to 935 people and organisations. Below you can view the list of Noble Prize winners across five categories for any year.</p>  
    
    <select id="startYear">...</select>
    <select id="endYear">...</select>
    <select id="categories">...</select>
    <select id="bornCountry">...</select>
    <button onclick="submitCriteria()">Submit</button>
    <p id="filterNobels"></p>
    
  
<script>  
const ALL = "All"
  
function loadNobelWinners() {
 var xmlhttp = new XMLHttpRequest()
 var url = "nobelWinners.json"

  xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {        
          window.nobelWinners = JSON.parse(xmlhttp.responseText)
          displayYearRange(nobelWinners)
          displayCategories(nobelWinners)
          displayCountries(nobelWinners)
      }
  }
  xmlhttp.open("GET", url, true)
  xmlhttp.send()
}

loadNobelWinners()
  
function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1)
}
  
function displayCategories(nobels) {
  var categories = new Set([ALL])
  for (var i = 0; i < nobels.laureates.length; i++) {
    for (var j = 0; j < nobels.laureates[i].prizes.length; j++) {
      var category = nobels.laureates[i].prizes[j].category
      if (category !== undefined ) {
        categories.add(category)
      }
    }
  }
  
  var options = "";
  Array.from(categories).sort().forEach(category => {
      options += "<option>" + capitalizeFirstLetter(category) + "</option>"
  })  

  document.getElementById("categories").innerHTML = options
}

function displayCountries(nobels) {
  var countries = new Set([ALL])
  for (var i = 0; i < nobels.laureates.length; i++) {
      var bornCountry = nobels.laureates[i].bornCountry
      if (bornCountry !== undefined ) {
        countries.add(bornCountry)
      }
    }
  
  var options = "";
  Array.from(countries).sort().forEach(bornCountry => {
      options += "<option>" + capitalizeFirstLetter(bornCountry) + "</option>"
  })  

  document.getElementById("bornCountry").innerHTML = options
}

//Dropdown for year using https://stackoverflow.com/questions/20873302/html-looping-option-values-in-drop-down-list
    
function displayYearRange(nobels) {
  var startYear = new Set([])
  for (var i = 0; i < nobels.laureates.length; i++) {
    for (var j = 0; j < nobels.laureates[i].prizes.length; j++) {
      var start = nobels.laureates[i].prizes[j].year
      if (start !== undefined ) {
        startYear.add(start)
      }
    }
  }

  var startOptions = ""
  Array.from(startYear).sort().forEach(startYear => {
    startOptions += "<option>" + startYear +"</option>"
  })

  document.getElementById("startYear").innerHTML = startOptions
  
  
  
  var endYear = new Set([])
  for (var i = 0; i < nobels.laureates.length; i++) {
    for (var j = 0; j < nobels.laureates[i].prizes.length; j++) {
      var end = nobels.laureates[i].prizes[j].year
      if (end !== undefined ) {
        endYear.add(end)
      }
    }
  }
  
  var endOptions = ""
  Array.from(endYear).sort().reverse().forEach(endYear => {
    endOptions += "<option>" + endYear +"</option>"
  })

  document.getElementById("endYear").innerHTML = endOptions
  
}
function submitCriteria() {
  category = document.getElementById("categories").value
  // get selected born country
  country = document.getElementById("bornCountry").value
  // get start year
  
  // get end year

  // filter nobels
  var filteredLaureates = nobelWinners.laureates.filter(laureate => laureate.prizes.some(prize => {
    return category === ALL || prize.category === category.toLowerCase()
  }))
  
  var filteredCategories = removeOtherCategories(filteredLaureates, category)
  
  
  var laureatesHtml = filteredCategories.reduce((acc, laureate) => {
    return `${acc}<tr><td>${laureate.firstname}</td><td>${laureate.surname}</td><td>${htmlForCategoryCell(laureate.prizes)}</td><td>${htmlForYearCell(laureate.prizes)}</td></tr>` 
  }, "<table><tr><th>Firstname</th><th>Surname</th><th>Category</th><th>Year</th></tr>") + "</table>"
  
  document.getElementById("filterNobels").innerHTML = laureatesHtml
  
  
}
  
function htmlForCategoryCell(prizes) {
  return prizes.map(prize => prize.category).join(", ")
}
  
function htmlForYearCell(prizes) {
  return prizes.map(prize => prize.year).join(", ")
}
  
  
function removeOtherCategories(laureates, category) {
  return laureates.map(laureate => {
    filteredPrizes = laureate.prizes.filter(prize => category === ALL || prize.category === category.toLowerCase())
    
    return Object.assign({},laureate, {prizes: filteredPrizes})
  })
}

  
</script>
</body>
</html>